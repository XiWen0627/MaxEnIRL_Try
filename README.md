# MaxEnDeepIRL Application for uncovering visual preference in cycling route decision procedure.
XiWen0627's Master Project : Unraveling  Built Environment Preference to Route Choice via IRL Approach 

## Introduction: importance of cycling and DBS system 
Cycling, widely recognized as a sustainable means of transportation, promotes outdoor activities and presents a potential solution to urban challenges such as traffic congestion and air pollution. The emergence of Dockless Bike Sharing (DBS) has further enhanced cycling by significantly improving accessibility to active travel. Consequently, DBS has garnered widespread adoption across numerous countries and has surged in popularity, particularly following the Covid-19 pandemic. Unlike motor vehicle travel, cyclists make decisions based not only on long-term travel plans but also on immediate environmental factors. However, urban planning often fails to accommodate the unique characteristics of cycling behavior, resulting in insufficient support for cyclists. Therefore, gaining a detailed understanding of cyclists' preferences and behaviors within DBS systems is crucial for bicycle-friendly urban planning.     **->Background**

The integration of GPS devices in DBS systems generates valueable location-based data, sparking significant academic interest in the fields of transportation and urban planning. Researchers have diligently studied cyclists' behavior and its correlation with various environments using data driven approaches. However, existing studies often prioritize analyzing cyclists' Origins and Destinations (ODs) rather than examining the detailed cycling procedures. This oversight may limit urban planners' understanding of how cyclists' behaviors relate to their on-site environments, which are crucial for understanding environmental preferences and influencing the scientific design of urban streets.


Consequently, we identified two key challenges concerning cyclists' preferences for their surroundings during DBS cycling.    **The importance of cycling procedure**

**The primary challenge lies in comprehensively understanding and decribing the detailed procedures of cycling**. One of the most common and intuitive methods is Route Choice Modeling(RCM), which predicts the possible paths that individuals follow during their trips. Typically, the principles uncovered in route selection are often interpreted as cycling preferences. The RCM framework is highly regarded for its potential and effectiveness in integrating new data and methodologies. Some studies integrate DBS trajectory data into RCM, treating cycling volume as a proxy for subjective preferences. However, DBS volume, affected by supply, demand, and temporal patterns, maks it difficult to accurately infer cyclists’ preferences from aggregated data. Some researchers have combined Agent-Based Model (ABM) with RCM to simulate real-time interactions from cyclists’ perspective. Yet, the development of such studies often rely on pre-defined indices and behavioral rules,  potentially overlooking implicit information in cyclists' decision-making processes. In other domains like ridesharing, deep learning methods like LSTM and GRU capture spatiotemporal dependencies in trajectories. However, cyclists, who both use and navigate the environment, exhibit different decision-making patterns compared to taxi passengers. Thus, understanding individual cycling processes is crucial for data-driven approaches to uncover cyclists' preferences.

**Another challenge followed immedaitely is to uncover cyclists'environmental preferences in cycling procedures.** Traditionally, traffic surveys are employed to explore the relationship between cycling behavior and macro-level Built Environment (BE) factors like infrastructure and land use. Yet, they often overlook preferences for various micro-level Street Environment (SE) visual features, limiting practical applications in urban planning. Moreover, existing studies frequently assume linear utility functions, which fail to adequately capture the complex and nonlinear routing decisions influenced by environmental factors. The emergence of multisource big data and Artificial Intelligence (AI) offers new opportunities to accurately capture cyclists' experiences in urban environments. Street View Images (SVI) and DBS trajectory data allow for a human-centric characterization of cyclists' routing decisions, with AI advancements extracting intricate preferences from diverse data sources. However, deep learning methods often lack explanatory, resulting in limited applicability in urban planning. In summary, these data-driven technological advances pave the way for a cognitively interpretable model framework to uncover cyclists' environmental preferences from their cycling procedures.

There are two gaps in the data-driven research on the cyclists' preferences for street environments. The first is how to understand cycling procedures while considering the impact of SE. The second lies on how to extract coherent cycling preferences towards SE from highly random and heterogeneous big data.

In recent years, reinforcement learning(RL) has shown excellent ability in dealing with sequential decision-making problems in random situations (Li, 2023; Qin et al., 2022), and has been widely adopted in trajectory data mining, route recommendation, vehicle repositioning and other researches. However, RL methods often rely on predefined operating rules (Rong et al., 2016; Yu et al., 2019; Yu & Gao, 2022), while the Inverse Reinforcement Learning(IRL) reverses the above process and recovers the principles that the agent potentially follows from the cycling information through the combination of simulation and training(Abbeel & Ng, 2004; Ng & Russell, 2000), which provides an opportunity for researchers to measure cycling procedures and reveal the complex cyclists' environmental preferences from given data.

To build upon existing research and bridge identified gaps, we propose a framework that integrates multi-source big data and IRL to quantify and interpret the preferences in the route choice process. Specifically, we take Bantian Community, Longgang District, Shenzhen as the empirical research area, and on the basis of reconstructing the route decision-making process of cyclists, we integrate data such as DBS trajectories and street view images (SVI), and employ the maximum entropy deep inverse reinforcement learning (MEDIRL) method to automatically reveal the position preference from the perspective of cyclists. To verify the method's effectiveness, we simulate trajectories based on the extracted position preferences, and assess the similarities between these simulated trajectories and the real trajectories. Finally, we adopt explainable artificial intelligence (XAI) techniques to illustrate the complex relationship between cyclists' real-time perception and route decisions.
The major contributions of this study can be concluded in three aspects:

 1. We proposed a comprehensive framework for unraveling the cycling preference of urban streets, emphasizing a detailed process that goes beyond conventional OD analysis. DBS trajectories offer insights into the entire cycling process, enabling a more nuanced understanding of cycling route decision, while SVI provides opportunities to accurately describe street-level visual features related to cycling trips.
     
 2. Our study proposed a novel cycling preference quantification and interpretation method, leveraging results derived from MEDIRL and XAI models. This method automatically establishes a robust link between the street environment and cycling behavior, explicitly considering their complex interactions. Compared to existing methods, our data-driven method offers enhanced reliability and reasonability.
    
 3. We applied our proposed framework in a real-world scenario, specifically in Ban Tian community in Longgang District, Shenzhen. The quantification and interpretation of cyclists’ preferences were conducted by considering both path-level (i.e., OD) and link-level characteristic for each trajectory. The practical case study underscores the feasibility and reliability of our proposed method.

The rest of the paper is organized as follows. Section 2 introduces the study area and dataset. Section 3 outlines our methodological framework, including maximum entropy deep inverse reinforcement learning, explainable artificial intelligence, and the metrics we utilized. In section 4, we conduct an empirical research in study area to validate the reliability and explainability of our approach. Section 5 summarizes this research and outlines the future work.
